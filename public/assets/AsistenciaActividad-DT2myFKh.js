import{u as h}from"./useQuery-B1_-BtmL.js";import{u as w}from"./useMutation-pGBE3Hp3.js";import"./get-gymAppointment.action-MaNvoU2J.js";import{G as f,p as d,q as _,N as E,o as l,c as m,w as c,k as C,i as q,e as B,a as p,g as S,l as x}from"./index-sHibMg66.js";import{V as N}from"./VDataTable-BDRGGwgc.js";import{V as U}from"./VSelect-Sf9-F91M.js";import{V as b}from"./VCard-BUQRQFkm.js";import"./useQueryClient-Bl_sPW2t.js";import"./VTextField-0iIl3hTZ.js";const z=async o=>{try{const{data:e}=await f.get(`agenda-actividades/${o}`);return e}catch{throw new Error("Error getting appointment by action")}},D=async(o,e)=>{try{const{data:i}=await f.patch(`agenda-actividades/asistencia/${o}`,{asistencia:e});return i}catch{throw new Error("Error updating attendance")}},F={key:0},I={__name:"AsistenciaActividad",props:{idActivity:{type:String,required:!0}},setup(o){const e=["Confirmado","Ausente"],i=o,y=d([{key:"folio",title:"Folio"},{key:"id_usuario",title:"Usuario"},{key:"asistencia",title:"Asistencia"},{key:"confirmar_asistencia",title:"Confirmar asistencia"}]),r=d({}),{data:u,isLoading:v,refetch:A}=h({queryKey:["appointmentActivity",i.idActivity],queryFn:()=>z(i.idActivity)}),V=_(()=>{if(!u.value)return[];const a=u.value.data||[];return a.forEach(t=>{t.folio in r.value||(r.value[t.folio]=t.asistencia||"")}),a}),{mutate:g}=w({mutationFn:({folio:a,asistencia:t})=>D(a,t),onSuccess:()=>{console.log("Asistencia actualizada correctamente"),window.location.reload()},onError:a=>{console.error("Error al actualizar la asistencia:",a.message)}}),k=a=>{const t=r.value[a];if(!a||!t){console.error("Datos incompletos para actualizar la asistencia");return}g({folio:a,asistencia:t})};return E(()=>{i.idActivity&&A()}),(a,t)=>(l(),m(b,null,{default:c(()=>[C(v)?(l(),q("div",F,t[0]||(t[0]=[B("h1",null,"Cargando informaciÃ³n...",-1)]))):(l(),m(N,{key:1,headers:y.value,items:V.value},{"item.asistencia":c(({item:n})=>[p(U,{modelValue:r.value[n.folio],"onUpdate:modelValue":s=>r.value[n.folio]=s,items:e,rules:[s=>!!s||"Asistencia requerida"],required:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),"item.confirmar_asistencia":c(({item:n})=>[p(x,{color:"primary",onClick:s=>k(n.folio)},{default:c(()=>t[1]||(t[1]=[S(" Confirmar ")])),_:2},1032,["onClick"])]),_:1},8,["headers","items"]))]),_:1}))}};export{I as default};
