import{u as f}from"./useQuery-Ico0mqlw.js";import{u as G}from"./useMutation-BcsYU11w.js";import{G as h,d as K,x as M,p as l,N as b,Q as c,S as Q,T as u}from"./index-D8apdIrF.js";import"./get-subscribe.action-qfxfOJMv.js";import{g as j}from"./get-subscription-by-id.action-Dn4hsDQQ.js";import{C as z,u as B}from"./CustomInput-Psgnhk9x.js";import{f as L}from"./dateUtils-CyrnVGE1.js";import{g as N}from"./get-memberships.action-DNV8Kcpb.js";const R=async i=>{const e=i.id;return e&&e!==""?await T(e,i):await U(i)},T=async(i,e)=>{try{const{data:t}=await h.patch(`/inscripciones/editar/${i}`,e);return t}catch(t){throw console.log(t),new Error("Error updating subscription")}},U=async i=>{try{const{data:e}=await h.post("inscripciones/crear",i);return e}catch(e){throw console.log(e),new Error("Error creating subscription")}},V=Q({id_usuario:u().required(),id_membresia:u().required(),fecha_inicio:u().required()}),Z=K({components:{CustomInput:z},props:{idSubscription:{type:String,required:!0}},setup(i){const e=M(),t=l(""),m=l([]),{data:a,isError:y,isLoading:S,refetch:_}=f({queryKey:["subscription",i.idSubscription],queryFn:()=>j(i.idSubscription),retry:!1}),{data:s}=f({queryKey:["memberships"],queryFn:N}),{mutate:v,isSuccess:g,data:d}=G({mutationFn:R}),{values:w,defineField:o,errors:q,resetForm:p,handleSubmit:A}=B({validationSchema:V}),[E,F]=o("id_usuario"),[C,I]=o("id_membresia"),[$,x]=o("fecha_inicio"),D=A(async r=>{const n={...r,fecha_inicio:L(r.fecha_inicio)};v(n)});return b(()=>{y.value&&!S.value&&e.replace({name:"listaInscripciones"})}),c(a,()=>{!a.value||!a.value.data||p({values:a.value.data})},{deep:!0,immediate:!0}),c(g,r=>{r&&(t.value="InscripciÃ³n actualizada correctamente",e.replace(`/admin/inscripciones/lista/${d.value.data.id}`),p({values:d.value}))}),c(()=>i.idSubscription,()=>{_()}),b(()=>{var r;!s.value||!s.value.data||(m.value=(r=s.value)==null?void 0:r.data.map(n=>n.id))}),{values:w,mensaje:t,errors:q,subscription:a,memberships:m,id_usuario:E,id_usuarioAttrs:F,id_membresia:C,id_membresiaAttrs:I,fecha_inicio:$,fecha_inicioAttrs:x,onSubmit:D}}});export{Z as _};
